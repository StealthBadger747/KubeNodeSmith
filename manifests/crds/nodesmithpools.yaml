apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: nodesmithpools.kubenodesmith.parawell.cloud
spec:
  group: kubenodesmith.parawell.cloud
  scope: Namespaced
  names:
    plural: nodesmithpools
    singular: nodesmithpool
    kind: NodeSmithPool
    shortNames:
      - nspool
  additionalPrinterColumns:
    - name: Provider
      type: string
      jsonPath: .spec.providerRef
    - name: Min
      type: integer
      jsonPath: .spec.limits.minNodes
    - name: Max
      type: integer
      jsonPath: .spec.limits.maxNodes
    - name: Age
      type: date
      jsonPath: .metadata.creationTimestamp
  versions:
    - name: v1alpha1
      served: true
      storage: true
      subresources:
        status: {}
      schema:
        openAPIV3Schema:
          type: object
          properties:
            spec:
              type: object
              required:
                - providerRef
                - limits
                - machineTemplate
              properties:
                providerRef:
                  type: string
                poolLabelKey:
                  type: string
                limits:
                  type: object
                  required:
                    - minNodes
                    - maxNodes
                    - cpuCores
                    - memoryMiB
                  x-kubernetes-validations:
                    - rule: "self.minNodes >= 0 && self.maxNodes >= 0"
                      message: "minNodes and maxNodes must be ≥ 0"
                    - rule: "self.minNodes <= self.maxNodes"
                      message: "minNodes must be ≤ maxNodes"
                    - rule: "self.cpuCores >= 0 && self.memoryMiB >= 0"
                      message: "cpuCores and memoryMiB must be ≥ 0"
                  properties:
                    minNodes:
                      type: integer
                      format: int32
                    maxNodes:
                      type: integer
                      format: int32
                    cpuCores:
                      type: integer
                      format: int64
                    memoryMiB:
                      type: integer
                      format: int64
                machineTemplate:
                  type: object
                  required:
                    - kubeNodeNamePrefix
                  properties:
                    kubeNodeNamePrefix:
                      type: string
                    architecture:
                      type: string
                    labels:
                      type: object
                      additionalProperties:
                        type: string
                scaleUp:
                  type: object
                  properties:
                    batchSize:
                      type: integer
                      format: int32
                    stabilizationWindow:
                      type: string
                scaleDown:
                  type: object
                  properties:
                    maxConcurrent:
                      type: integer
                      format: int32
                    drainTimeout:
                      type: string
            status:
              type: object
              properties:
                observedGeneration:
                  type: integer
                  format: int64
                lastScaleActivity:
                  type: string
                  format: date-time
                conditions:
                  type: array
                  items:
                    type: object
                    required:
                      - type
                      - status
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      reason:
                        type: string
                      message:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
